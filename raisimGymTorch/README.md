## raisim_env_anymal

### How to use this repo

There is nothing to compile here. This only provides a header file for an environment definition. Read the instruction
of raisimGym.

To run this part, please use the anaconda environment which is described in `conda_env_raisim_gym.yml`.

### Dependencies

- raisimgym

### Run

1. Compile raisimgym: ```python setup develop```
2. run runner.py of the task (for rsg_ouzel example): ```cd raisimGymTorch/env/envs/rsg_ouzel && python ./runner.py --config cfg_local.yaml```

### Test policy

1. Compile raisimgym: ```python setup develop```
2. Start the simulation viewer with ```./raisimUnity/linux/raisimUnity.x86_64``` and tick "auto-connect"
3. run tester.py of the task with policy (for rsg_ouzel
   example): ``` python raisimGymTorch/env/envs/rsg_ouzel/tester.py  --weight data/ouzel_only_planning/2022-05-09-12-17-53/full_123000.pt --config cfg_local.yaml```

The tester script produces plots which can be found in ```data/images```. 

### Retrain policy

1. run runner.py of the task with policy (for anymal
   example): ``` python raisimGymTorch/env/envs/rsg_ouzel/runner.py --mode retrain --weight data/ouzel_only_planning/2022-05-09-12-17-53/full_123000.pt --config cfg_local.yaml```

### Debugging

1. Compile raisimgym with debug symbols: ```python setup develop --Debug```. This compiles <YOUR_APP_NAME>_debug_app
2. Run it with Valgrind. I strongly recommend using Clion for debugging.

### Launch Tensorboard
This allows you to look at the training data in real time.

1. run ```$ python raisimGymTorch/env/envs/rsg_ouzel/tensorboard_launcher.py ```

### Convert policy to C++ capable version
PyTorchLib C++ needs the policy network to be in another format then what is generated by the training script. To convert
the policy to the C++ version run:
``` python raisimGymTorch/env/envs/rsg_ouzel/model_export.py --weight data/ouzel_only_planning/2022-05-09-12-17-53/full_123000.pt --config cfg_1.yaml```


### Envs

- rsg_anymal is the demo environment which is included in the original repo.
- rsg_ouzel is the environment containing the ouzel OMAV.
- rsg_ouzel_delta is based on rsg_ouzel but uses a model which also contains the delta arm.
  - running training, testing etc for rsg_ouzel_delta is the same as for rsg_ouzel but in the rsg_ouzel_delta folder.